<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
	 <title>Textové súbory</title>
	 <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=windows-1250">
 	 <meta name="Content-language" content="sk">	
	  <LINK href="../css/style.css" type="text/css" rel=stylesheet>
</head>

<body>
<center><H3 class=nadpis>&nbsp;Binárne súbory</H3></center>
<dl><dt class=main>Súbor
	<dd><b>Textové súbory</b> majú vıhodu, e je moné kedyko¾vek si prehliadnu ich obsah, vytvori ich alebo upravi benım editorom. To je aj dôvod, preèo sú vhodné na ukladanie textu.
		Na ukladanie inıch dátovıch typov sa síce môu poui, ale nie je to vıhodné, pretoe napríklad èíslo 65535 zaberie v textovom súbore priestor 5 Byte a v binárnom len 2 Byte.
		Ïalej nie sú vhodné na ukladanie polí, pretoe medzi jednotlivé prvky po¾a ešte musíme vloi nejakı separátor, napriklad medzeru a tım je súbor automaticky väèší.
		<br>Za najväèší nedostatok tıchto súborov je ale prístup ku dátam:
		<ul><li>èíta aj zapisoava môeme len sekvenène
			<li>Zmena textového súboru je moná len obtiane (vytvori kópiu so iadanou zmenou, odstránenie pôvodného a napokon premenovanie kopie na originál)
		</ul>	
		<b>Binárne súbory</b> majú nevıhodu, e síce si ich obsah môme prehliadnu napríklad PSPad editorom, ale dáta okrem textovıch sú prakticky neèitate¾né a editorom nieèo v nich meni 
		je prinajmenšom nevhodné, pretoe môeme viac pokazi ako napravi.
		<br>Vıhodou je, e sú väèšinou menšie, rıchlejšie sa s nimi pracuje a pri ukladaní polí nepotrebujú separátor, hlavná vıhoda ale tkvie v tom e:
		<ul><li>môeme ich èíta v ¾ubovo¾nom poradí
			<li>vetu mono aj meni (samozrejme sa musí zachova dåka vety)
		</ul>	
		Podobne ako pri textovıch súboroch môme voli "klasiku" a prúdy, teraz sa obmedzím len na prácu s prúdmi (fstream)

	
	<dd><h3>Prúdy - kninica fstream.h</h3>
Podobne ako pri práci so štandartnım vstupom-klávesnicou a štandartnım vıstupom-monitor aj tu mono prácu rieši objektovo - pomocou streamov.
<dl>
<dt>Kninica
<dd>Príkazy, deklarácia typov, konštánt sú v kninici <b>fstream</b>
<dt>Deklarácia premennıch
<dd>ifstream prem1; // premenná pre vstup zo súboru
	<br>ofstream prem2; // premenná pre vıstup do súboru 
	<br>fstream prem3; // umoòuje èítanie i zápis - my toto budeme pouíva keï budeme chcie meni súbor
	<br>Pri deklarácii mono hneï aj otvori prepojenie na konkrétny súbor
	<br>ifstream prem1(text);
	<br>ofstream prem1(text);
	<br>V texte je adresa s názvom súboru, takto zadefinovanú premennú u netreba otvára, overenie èi sa otvorenie podarilo
	urobíme pomocou testu <b>if (prem1)</b> èo vráti <b>true</b> ak sa otvorenie podarilo.
	<br>alebo pomocou <b>if (prem1.is_open())</b>
	
<dt>Otvorenie súboru - èítanie
<dd>Ak v deklarácii neuvedieme názov súboru je nutné vytvori spojenie našej premennej so súborom pomocou príkazu open.
    <ul><li><b>prem1.open(string)</b> // v stringu je zapísanı názov súboru (prípadne aj s cestou), otvorí na èítanie, kurzor je na zaèiatku
		<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ak súbor neexistuje (otvorenie sa nepodarí) môme otestova pomocou 
		<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; logickej funkcie prem1.fail() alebo testom priamo premennej prem1
		<br><b>prem2.open(string)</b> // v stringu je zapísanı názov súboru (prípadne aj s cestou), otvorí na zápis
		<li><b>prem1.open(string, ios::binary)</b> //je vhodné systému poveda, e chceme pouíva binárny prístup ku súboru
	</ul>	
<dt>Otvorenie súboru - zápis
<dd><ul><li><b>prem2.open(string)</b> // v stringu je zapísanı názov súboru (prípadne aj s cestou), 
		<br>súbor (string) ak existuje tak sa vymae, inak sa vytvorí novı prázdny a otvorí na zápis. Implicitne sa navolí mód ios::out.
		<li><b>prem2.open(string, mod)</b> 
			Monosti pre mod:
			<ul><li><b>ios::out</b> - ak existuje tak sa vymae, inak sa vytvorí novı prázdny a otvorí na zápis
					<br>vety teraz zapísané mono meni zmenou polohy zapisovacieho kurzora
					<br>keïe otvorenie súboru nám vymae všetko, èo v súbore bolo, je jasné, e tımto postupom "staré" vety v súbore nemono meni 
				<li><b>ios::app</b> - otvorí existujúci súbor a kurzor nastaví za poslednú vetu, zápis bude robenı pridávaním viet
					<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; v tomto móde nemono presúva kurzor
				<li><b>ios::binary</b> - budeme robi binárny zápis
			</ul> 
			Jednotlivé módy mono zada aj viaceré pomocou operátora | (èo je bitovı OR = pipeline)
<dt>Otvorenie súboru - zmena
<dd>Ak chceme meni zapísané dáta, musíme súbor otvori aj na zápis aj na otvorenie - premenná musí by typu fstream a potom mod musí by uvedenı.
	<br>Uvediem len spôsob otvorenia súboru ak chceme meni u zapísané vety.
	<ul><li>prem3.open("data.dat", ios::in|ios::out|ios::binary)
			<br>názov súboru som zvolil data.dat
	</ul>		 
	

<dt>Zápis do súboru
<dd>Zápis mono robi pomocou funkcie write() alebo pomocou funkcie put() 
	<br>Zmenu polohy zapisovacieho kurzora môme robi funkciou seekp()
	<ul><li>seekp(int pos);  //pozíciu kurzora nastavujeme v bajtoch, 
			<br>toto pouívame len ak <i>nepouívame</i> mod= <b>app</b>
			<br>zmenou polohy zapisovacieho kurzora mono prepísa u zapísané vety
		<li>prem.write(char * p, pocet) 
			<br>predpísanı poèet bajtov z pola p sa zapíše do súboru od polohy zapisovacieho kurzora
			<br>zapisovací kurzor bude po skonèení zápisu za poslednım zapísanım znakom (èo nemusí by koniec súboru)
			<br>ak chceme zapísa údaje z iného typu ako je pole charov, musíme tú premennú pretypova
			<br>pretypovanie spoèíva v príkaze: túto adresu cháp ako pole charov
		<table width="60%" bgcolor="#c0c0c0" border="2" bordercolor="#cccccc" bordercolordark="#999999" bordercolorlight="ffffff">
		<tr><th bgcolor="Blue" align="left"> Unit1.cpp</th></tr>
		<tr><td>
<pre>
#include &lt;fstream&gt;
using namespace std;
...
typedef struct {double x,y,z;}Tbod;
Tbod a[100];
...
ofstream fo;
fo.open("body.dat", ios::out|ios::binary);
for (i=0; i<100; i++)  fo.write( (char *)&amp;a[i], sizeof(Tbod) );
//alebo fo.write( (char *)(a+i), sizeof(Tbod) );
fo.close();
</pre>
		</td></tr>
		</table>
	</ul>		
Otvorením súboru v móde out sa z neho vymazali všetky dáta (ak tam nejaké boli)
<br>kadım wrajtom som zapísal jeden bod (tri premenné typu double)
<br>údaje sú zapísané "natesno" t.j. bez oddelovaèov a bez ukonèovaèa vety 

<dt>Èítanie zo súboru
<dd>Èítanie mono robi pomocou funkcie read(), ktorá má rovnaké parametre ako write()
	<br>pri èítaní sa nerobí iadna kontrola nad èítanımi znakmi - naèítame aj medzery, nulové znaky atï.
	<ul><li>seekq(int pos);  //pozíciu kurzora nastavujeme v bajtoch, 
			<br>súbor teda mono èíta v ¾ubovo¾nom poradí
		<li>prem.read(char * p, pocet) 
			<br>predpísanı poèet bajtov zo súboru (od polohy èítacieho kurzora) sa zapíše na zadanú adresu pola p od polohy zapisovacieho kurzora
			<br>èítací kurzor bude po skonèení èítania za poslednım preèítanım znakom (èo nemusí by koniec súboru)
			<br>ak chceme èíta údaje do iného typu ako je pole charov, musíme tú premennú pretypova
			<br>pretypovanie spoèíva v príkaze: túto adresu cháp ako pole charov
		<table width="60%" bgcolor="#c0c0c0" border="2" bordercolor="#cccccc" bordercolordark="#999999" bordercolorlight="ffffff">
		<tr><th bgcolor="Blue" align="left"> Unit1.cpp</th></tr>
		<tr><td>
<pre>
#include &lt;fstream&gt;
using namespace std;
...
typedef struct {double x,y,z;}Tbod;
Tbod a[100];
...
ifstream fi;
fi.open("body.dat", ios::in|ios::binary);
for (i=0; i<100; i++)  fi.read( (char *)&amp;a[i], sizeof(Tbod) );
//alebo fi.write( (char *)(a+i), sizeof(Tbod) );
fo.close();
</pre>
		</td></tr>
		</table>
	</ul>		
	Kadım readom som naèísal jeden bod (tri premenné typu double), vyuívam to, e všetky vety sú rovnako dlhé
	<br>to však nie je nutná podmienka.
	<dl><dt>test vykonania operácie
		<dd><ul><li>good(prem1) - vráti 1 ak posledná operácia dopadla dobre, 0 ak zle
				<li>fail(prem1) - vráti 0 ak posledná operácia dopadla dobre, 1 ak zle
			</ul>
	</dl>
	<dt>Zmena súboru
	<dd>Máme binárny súbor, v òom dáta a niektoré chceme zmeni (napr. jednému bodu zmeníme súradnice)
		<br>premenná bude typu fstream a otvoríme ju v móde in aj out
		<br>Pouíva budeme príkazy ako pri zápise do súboru, len pomocou tohoto "èudného" otvorenia zabezpeèím
		e sa dáta pri otáraní nestratia a pomocou seekp() môeme nastavova kurzor na tieto vety.
		<table width="60%" bgcolor="#c0c0c0" border="2" bordercolor="#cccccc" bordercolordark="#999999" bordercolorlight="ffffff">
		<tr><th bgcolor="Blue" align="left"> Unit1.cpp</th></tr>
		<tr><td>
<pre>
#include &lt;fstream&gt;
using namespace std;
...
typedef struct {double x,y,z;}Tbod;
Tbod a[100];
...
fstream f;
f.open("body.dat", ios::in|ios::out|ios::binary);
f.seekp(5*sizeof(Tbod));                           //kurzor na vetu cislo 5
f.write( (char *)&amp;a[5], sizeof(Tbod) );        //veta prepisana
//alebo f.write( (char *)(a+5), sizeof(Tbod) );
fo.close();
</pre>
		</td></tr>
		</table>
		V tejto ukáke som zmenil vetu èíslo 5 (šiestu vetu). Je moné meni/zapisova aj jednotlivé súradnice, napríklad ak chcem zapísa len sur. y:
		<br>f.seekp(5*sizeof(Tbod)+sizeof(double));                           //kurzor na vetu cislo 5 sur. y
		<br> 
</dl>
</body>
</html>
