<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<html>
<head>
	 <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=windows-1250">
	<meta name="Content-language" content="sk">
	  <LINK href="css/style.css" type="text/css" rel=stylesheet>	
	<title>Databáza</title>
</head>

<body>
PHP by urèite nebolo tak rozšírené , keby nevedelo pracova s databázami , najmä s MySQL . 
Databázy sú téma ve¾mi rozsiahle a u to vydalo na ve¾a seriálov . My sa sústredíme na to , 
èo nám pomôe vybudova kvalitnı PHP - databázovı web . Pokia¾ s databázami aktívne pracujete , 
budete pravdepodobne schopní tento èlánok vynecha , ak nie, èítajte pozorne ïalej.
<br>
<br>
Aby sme mohli nejako úèinne pracova s databázami , predstavme si teraz , ako sú dáta v tıchto databázach uloené . 
<BR><br>
<b>Relaèné model </b>
<br>Dáta sú v databázach uloené v celkoch , ktorım sa hovorí tabu¾ky . Majme napríklad tabu¾ku autorov , 
ktorí prispievajú na portál Linuxsoftu . Táto tabu¾ka by mohla vyzera nasledovne : 
<table border="1" width="300">
<tr ><th> Jmeno<th>Prijmeni<th>Email</tr> 
<tr><td style="padding-left:5"> Petr <td>Zajac<td>petr@xzajic.cz </tr>
<tr><td> Pavel<td>Adam<td>pa@pajus.com </tr>
<tr><td> Niekto<td>Inı<td>kdosi@kdesi.cz </tr>
 </table>

Keï ste niekedy pracovali napríklad s OpenOffice , môete si to predstavi ako list aplikácie Calc. Naša tabu¾ka má tri ståpce 
a nejakı poèet riadkov. Kadı riadok v tabu¾ke obsahuje urèitú skupinu dát , teda napríklad údaje o jednej osobe . 
Keï budeme pridáva riadky , znamená to , e meníme dáta v tabu¾ke , ak budeme pridáva ståpce , 
znamená to, e meníme štruktúru tabu¾ky . 
<br>Pozn : databázovému riadku sa tie niekedy hovorí veta alebo záznam (record). 
<br>
<br>To bolo pomerne jednoduché .Teraz si predstavte , e budete chcie ma inú tabu¾ku , ktorá bude obsahova údaje o tom, 
kto napísal na server školy aké èlánky. To u je zaujímavejšie problém. Ide toti o to (a väèšinou to tak bıva), 
e jeden autor napíše viac èlánkov .Ako by mohla takáto tabu¾ka vyzera ? Mohla by vyzera napríklad takto: 
<table border="1">
<tr><th>Jmeno <th> Prijmeni <th> Email <th> Nazov <th> URL</tr> 
<tr><td>Petr<td> Zajac <td> petr@xzajic.cz <td> PHP ( 1 ) história a budúcnos <th> http://www.linuxsoft.cz/article.php?id_article=171 </tr>
<tr><td>Petr <td> Zajac <td> petr@xzajic.cz <td> PHP ( 2 ) ako to funguje <td> http://www.linuxsoft.cz/article.php?id_article=172 </tr>
<tr><td>Pavel <td> Adam <td> pa@pajus.com <td> Úvod do C + + <td> http://www.linuxsoft.cz/article.php?id_article=196 </tr>
<tr><td>Niekto <td> Inı <td> kdosi@kdesi.cz <td> Mám rád gympel <td> http://www.utopia.sk/nikdy/sa_to_nestane.php </tr>
 </table>

To nás privádza k zaujímavému problému - meno, priezvisko a e - mail autora tam máme zbytoène v oboch tabu¾kách.
Ma v tabu¾ke èlánkov kompletné informácie o autoroch nemusia by z nieko¾kıch dôvodov vıhodné. Tak napríklad : 
<br>Tabu¾ka èlánkov bude zbytoène ve¾ká a pomalá , pretoe sa v nej údaje budú opakova.
<br>Keï budeme chcie zmeni, dajme tomu, e - mailovú adresu autora, budeme to musie urobi na viacerıch miestach.
<br>Keby sme chceli okrem mena, priezviska a e - mailu evidova ešte nieèo iné, budeme musie meni štruktúru nieko¾kıch 
(èasom skôr mnohıch ) tabuliek. 
Asi tušíte, e sa to tak v praxi naozaj nerobí - a máte pravdu. V praxi sa riadky v tabu¾ke autorov oèíslujú a namiesto toho, 
aby sa údaje opisovali do tabu¾ky èlánkov sa v tejto tabu¾ke uvedie len odkaz na súvisiace záznam. Asi bude najlepšie to ukáza : 
<table border="1">
<tr><th>ID<th>Jmeno<th>Prijmeni<th>Email</tr> 
<tr><td>1<td>Petr<td>Zajac<td>petr@xzajic.cz </tr>
<tr><td>2<td>Pavel<td>Adam<td>pa@pajus.com </tr>
<tr>3<td>Niekto<td>Inı <td>kdosi@kdesi.cz </tr>
</table>
<br>
<table border="1"> 
<tr><th>Autor<th>Nazov <th>URL</tr> 
<tr><td>1<td>PHP ( 1 ) história a budúcnos <td> http://www.linuxsoft.cz/article.php?id_article=171  </tr>
<tr><td>1<td>PHP ( 2 ) ako to funguje<td>http://www.linuxsoft.cz/article.php?id_article=172  </tr>
<tr><td>2<td>Úvod do C + + <td>http://www.linuxsoft.cz/article.php?id_article=196  </tr>
<tr><td>3<td> Mám rád gympel <td>http://www.utopie.cz/nikdy/se_to_nestane.php</tr>
</table>
Z toho môeme vidie, e sa nám tabu¾ka èlánkov smrskla z piatich polí na tri a e namiesto toho, aby sme uvádzali podrobnosti 
o kadom autorovi, uvádzame len èíslo záznamu v súvisiacej tabu¾ke. Vzahu medzi tabu¾kou autorov a èlánkov sa hovorí odborne relácie 
a práve preto, e mono dáta v tabu¾kách takto organizova, nazıvajú sa tieto databázy relaèné . 
<br>
<br><b>Ståpce tabu¾ky </b>
<br>Zhruba povedané sa do tabu¾ky dá uklada to, èo sa v PHP dá uklada do premennıch. Take reazce ( jedno alebo vícepísmenné ), 
logické hodnoty, dátumy a rôzne presné èísla. Kadı ståpec tabu¾ky má pri jej zaloení urèenı typ dát, ktoré sa do neho budú uklada. 
Keï sa pokúsite do ståpca uloi hodnotu iného dátového typu, môu databázy reagova rôzne - niekedy vykonajú èosi ako pretypovanie, 
niekedy to skonèí chybou. V MySQL sa najèastejšie pouívajú nasledujúce typy ståpcov: 

Typ ståpca 
 Èo do neho 
 Rozsah 
 
int 
 Celé èísla 
 -2147483648 a -2147483647  
char ( n ) 
 Reazca 
 Práve n znakov dlhé reazce 
 
varchar ( n ) 
 Reazca 
 Maximálne n znakov dlhı reazec 
 
date 
 Dátumy 
 1.1.1000 a 31.12.9999 
 

Kde niè nie je ... 
tam smr síce neberie , ale databáza áno . Zvyknite si na to , e v tabu¾kách nebıvajú všetky polia povinné . Dajme tomu , e by sme v databáze autorov u niekoho nevyplnili e - mail , pretoe ho nevieme . V tom prípade môu nasta pri uloení riadku zhruba dve situácie : 

Databáza má nariadené , e keï dané políèko nebude vyplnené , má tam doda nejakú predvolené ( default ) hodnotu . Trebárs prázdny reazec . 
Databáza nemá nariadené niè , a preto si poznamená , e obsah tohto po¾a je neznámy , èie NULL . 
NULL nie je rovné nièomu, èo sme a doteraz poznali . Nerovná sa nule , prázdnemu reazcu ani logické hodnote false . S NULL sa dajú robi databázové operácie , o ktorıch si povieme niekedy nabudúce . Ale u teraz by ste mali ma na pamäti , e to je osobitná vec . 

Nabudúce zanecháme suché teórie a ukáeme si, ako sa z PHP k databáze vôbec napoji . 




<br><br>
Paklie jste èetli minulé díly našeho seriálu, víte, e MySQL je systémová databáze a e tudí bìí jako serverovı proces. Proto musí kadı, kdo se chce k MySQL pøipojit, znát tyto pøihlašovací informace:


Název hostitele
MySQL pochopitelnì bìí na nìjakém stroji. Název hostitele se mùe zadávat jménem (tøeba mysql.nekde.cz) nebo IP adresou. Pokud budete provozovat MySQL server doma, mùete vìtšinou pouít localhost èi 127.0.0.1. Pokud se budete pøipojovat k MySQL u providera, název hostitele Vám sdìlí. 


Pozn.: Server, na nìm bìí databáze nemusí bıt nutnì tı, na nìm bìí webovı (http) server.

Port
MySQL naslouchá standardnì na portu 3306, pokud není pøi konfiguraci urèeno jinak. Pravdìpodobnì mùete port vynechat, 3306 je doplnìno automaticky.

Název databáze 
Zde by mohlo dojít k urèitému matení pojmù: Na databázovém serveru MySQL existuje vìtšinou nìkolik vzájemnì nesouvisejících databází. Kadá databáze obsahuje ádnou nebo více tabulek a kadá mùe mít vlastní nastavení práv. V praxi to vìtšinou bıvá tak, e souèástí hostingovıch slueb je monost pouívat jednu databázi. V ní mùete mít teoreticky nomezenı poèet tabulek a ostatní uivatelé serveru nemají k vaší databázi pøístup. Vy zase nemáte pøístup k jejich databázím.


Uivatelské jméno 
Znalci prominou, ale je potøeba zdùraznit, e uivatelské jméno k databázovému serveru nijak nesouvisí s pøihlašovacím jménem k serveru. Ve skuteènosti vìtšinou nebudete mít na serveru, na nìm databáze pobìí, zøízen systémovı úèet. Uivatelské jméno nejspíš dostanete od správce databáze.


Heslo 
Asi i heslo dostanete od správce databáze. Vìtšinou bude splòovat základní bezpeènostní pravidla, tzn. bude dostateènì dlouhé a bude se skládat z písmen, èíslic, pøípadnì dalších znakù. 


V PHP se k MySQL databázi mùete pøipojit pomocí funkce myslq_connect. Jejími parametry jsou název hostitele, uivatelské jméno a heslo. Po pøipojení k MySQL si ještì musíte vybrat svoji databázi, co se dìje pøíkazem mysql_select_db. Celé to mùe vypadat v nejjednodušším pøípadì takto:

<?
mysql_connect("localhost", "uzivatel", "heslo");
mysql_select_db("mojedb");
?> 
Ani bychom zabíhali do podrobností dodejme, e pokud to dopadne úspìšnì, budou se od tohoto místa ve skriptu všechny pøíkazy urèené pro MySQL provádìt na tomto spojení. Pokud v téme skriptu zavoláte mysql_connect znovu se stejnımi parametry, pokusí se PHP pouít první spojení nemísto vytvoøení nového (vytvoøení nového spojení jde ale vynutit pomocí nepovinného ètvrtého parametru funkce mysql_connect). Spojení vytvoøené pomocí mysql_connect je otevøené a do doby, ne je zavolána funkce mysql_close, nebo do ukonèení bìhu skriptu.


Trvalá spojení
K pøíkazu mysql_connect existuje alternativní pøíkaz mysql_pconnect. Jedinı rozdíl mezi nimi je ten, e mysql_pconnect se neuzavírá po ukonèení bìhu skriptu, ale zùstává otevøené. Mysql_pconnect lze pouít pouze tehdy, kdy bìí PHP jako modul Apache a jeho vızam spoèívá vlastnì jen v tom, e šetøí èas, kterı mysql_connect spotøebovává pøi kadém otevøení spojení.


Pozn.: V typickém prostøedí vícevláknovıch serverù je ale èas potøebnı pro vykonání funkce mysql_connect zanedbatelnı.


Profi pøístup
Jeliko je pøipojení k databázi nìco, co se bude v našich skriptech mnohokrát opakovat, mìli bychom si ukázat nìjakı pokroèilejší pøíklad na pøipojování. Naše ukázka má toti nìkolik zásadních nevıhod:


nikomu se asi nebude chtít psát do kadého skriptu údaje pro spojení 
neošetøujeme chyby 
typicky budeme mít vıvojové prostøedí doma a reálnou aplikaci "venku", take se údaje pro spojení budou lišit 
Všechno lze pomìrnì jednoduše øešit. Jak øíkal mùj uèitel programování: "Udìlej to jednou, udìlej to poøádnì a zapomeò na to". Pøedevším si údaje do spojení uloíme do konstant (mùete rovnì pouít napøíklad asociativního pole), abychom pøi zmìnì konfigurace nemuseli údaje pøepisovat na mnoha místech. Za druhé, konstanty uloíme do samostatného souboru, kterı pak vloíme do našich skriptù pomocí direktivy include. A za tøetí - pomocí promìnné prostøedí zjistíme, kde náš kód bìí a nastavíme hodnoty podle toho. Celı includovanı soubor pak mùe vypadat asi následovnì:

<?
if ($_SERVER["SERVER_ADDR"]=="localhost")
{
  define("SQL_HOST","localhost");
  define("SQL_DBNAME","database");
  define("SQL_USERNAME","user");
  define("SQL_PASSWORD","password");
}
else
{
  define("SQL_HOST","mysql.nekde.cz");
  define("SQL_DBNAME","databaze_u_providera");
  define("SQL_USERNAME","user2");
  define("SQL_PASSWORD","password2");
}
?>

Pozn.: Je samozøejmì moné mít místo toho dva soubory zaèlenìní, lokální a serverovı. Vìtšinou je ale døíve èi pozdìji pomícháte nebo pøepíšete, co se ve vıše uvedeném pøípadì nemùe stát.


A je tu èas vypoøádat se s chybami - jak mysql_connect, tak i mysql_select_db mohou skonèit chybou. Testovat to je naštìstí pomìrnì jednoduché, protoe v pøípadì úspìchu vracejí obì procedury FALSE.  Take mùeme pouít nìco ve smyslu:

<?
include ("config.php");
mysql_connect(SQL_HOST, SQL_USERNAME, SQL_PASSWORD) or die("Nelze se pøipojit k MySQL: " . mysql_error());
mysql_select_db(SQL_DBNAME) or die("Nelze vybrat databázi: ". mysql_error());    
?> 
kde config.php je soubor s definicí konstant (viz vıše). Jak jste nejspíš pochopili, vrací mysql_error chybovou hlášku z MySQL. Co se tıèe pouití die, mùete zavzpomínat na jeden z pøedchozích dílù našeho seriálu, kterı rozebírá jeho úskalí. Pokud by to, e se nemùete pøipojit k databázi nebylo pro skript fatální, nejspíš pouijete return.


Pøíklady
My budeme v seriálu pouívat pøesnì tuto metodu pøipojování. Pro demonstrativní úèely máme na serveru Linuxsoftu k dispozici databázi; platné hodnoty pøipojovacích údajù však nezveøejním. Na zaèátku kadého databázového skriptu budu vkládat soubor zaèlenìní (nìco jako vıše include("config.php")), kterı bude tyto údaje obsahovat. Ve vıpisu zdrojového kódu souboru bude tento øádek nahrazen komentáøem; fungovat to bude normálnì.
<br><br>
PHP (37) - Tvorba tabulek v MySQL
Ako sme si u ukázali , skladajú sa databáza z tabuliek a tabu¾ky zo riadkov a ståpcov . Predtım , ne môete nejakú tabu¾ku poui , musíte ju definova . K tomu slúi urèitá podmnoina príkazov jazyka pre prácu s databázou .


Ve¾mi ¾ahkı úvod do SQL

SQL , èie štruktúrovanı dopytovací jazyk je jazyk , ktorému rozumie databábáze . Take , typickı skript PHP pracujúce s databázou má nasledujúcu štruktúru :

Nejakı kód PHP , ktorı sa ( okrem iného ) postará o pripojenie k databáze 
Kód SQL , ktorı " povie " databázu , èo od nej potrebujeme 
Kód PHP , ktorı spracuje to , èo nám databáza odpovedala 
Kód PHP , ktorı spojenie k databáze uzavrie . 
Samotné príkazy jazyka SQL sa delia pod¾a úèelu , na ktorı pri komunikácii s databázou slúi na :

Oblas
 Popis
 Príkaz ( y )
 
Definiènı
 Umoòujú spravova štruktúru databázy
 CREATE TABLE , DROP TABLE
 
Vıberové
 Umoòujú získa z databázy dáta
 SELECT
 
Pridávací
 Umoòujú pridáva nové dáta do tabu¾ky alebo tabuliek
 INSERT
 
Aktualizaènı
 Umoòujú meni existujúce dáta v tabu¾kách
 UPDATE , REPLACE
 
Odstraòovacia
 Umoòujú zmaza riadky z tabu¾ky alebo tabuliek
 DELETE
 

Pozn : Nie sú všetky , len tie hlavné .

My sa dnes pozrieme na definície príkazy jazyka SQL a vytvoríme si v databáze tabu¾ku . K definovanie tabu¾ky slúi príkaz CREATE TABLE . Ako budete môc definova tabu¾ku , mali by ste presne vedie ko¾ko bude ma ståpcov , èo bude v jednotlivıch ståpcoch uloené a ako sa majú menova . Ak by ste napríklad chceli ma v tabu¾ke nejakı zoznam zamestnancov , mohol by definiènı príkaz vyzera takto :

CREATE TABLE zamestnanci (
jmeno varchar ( 10 ) ,
prijmeni varchar ( 15 ) ,
cislo int,
datum_narozeni date
) 
Èo preloené do slovenèiny znamená : " Milá databáza , mala by si zaèa nieèo robi . Potrebujem vytvori novú tabu¾ku , bude sa menova zamestnanci , a bude ma 4 ståpce nasledujúcich typov a ve¾kostí : ... " . Dovolil by som si k tomu nieko¾ko poznámok :


MySQL rozlišuje v názvoch tabuliek a názvoch ståpcov ve¾kos písmen . Take , pozor na to . Niektorí sa rozhodli písa všetko malımi písmenami , rozhodne treba ma v tom nejakı systém . 
Názvy ståpcov by mali by dostatoène vıstiné . 

Názvy ståpcov i tabuliek by mali by dostatoène krátke , inak sa upíše a budete robi viac chıb . 
Uvádza všetky podrobnosti syntaxe príkazu CREATE TABLE nebudeme , na to slúi oficiálnej dokumentácie. Z dôvodov , ktoré budeme vysvet¾ova neskôr však môe by vıhodné ma v tabu¾ke pole , ktoré sa bude postupne pri vloení záznamu èíslova . To by sme urobili nasledovne :

CREATE TABLE zamestnanci (
id INT NOT NULL AUTO_INCREMENT ,
prijmeni VARCHAR ( 20 ) NOT NULL ,
jmeno VARCHAR ( 10 ) NOT NULL ,
PRIMARY KEY ( id ) 
) 
ako vidíte , väèšinou sa jednoduchım poh¾adom na príkaz SQL dá odvodi , èo asi robí .


Opakom príkazu CREATE TABLE je potom príkaz DROP TABLE . Ten celú tabu¾ku odstráni . Take by ste mohli napísa :

DROP TABLE zamestnanci 
Ale pozor ! Tento príkaz bez milosti odstráni tabu¾ku iv prípade , e u v nej sú nejaké dáta . Mal by sa preto pouíva s rozvahou . Príkaz DROP TABLE u pochopite¾ne nepotrebuje pozna štruktúru tabu¾ky , pretoe ju rovnako bude maza .


Pozn : Väèšinou môe by vıhodnejšie poui na definovanie tabuliek nejakı hotovı program . V praxi to bıva èasto tak , e sa štruktúra tabuliek sa navrhuje mimo PHP a skripty neobsahujú ve¾a definiènıch príkazov .


Ako na to v PHP
V PHP slúi všeobecne k zasielanie príkazov jazyka SQL databáz príkaz mysql_query . Mysql_query vyaduje , aby u existovalo prepojenie na databázu vytvorené pomocou mysql_connect alebo mysql_pconnect . Ak spojenie existova nebude, pokúsia sa ho PHP vytvori s predvolenımi hodnotami (èo pravdepodobne zlyhá ) . Take by sme mohli napísa nieèo ako : 

< ?
/ / tu je include súboru s konštantami
mysql_connect(SQL_HOST, SQL_USERNAME, SQL_PASSWORD) ;
mysql_select_db(SQL_DBNAME) ;
mysql_query(" CREATE TABLE zamestnanci ( jmeno varchar ( 10 ) , prijmeni varchar ( 15 ) , cislo int, datum_narozeni date ) ")
or die (" Nemono vykona definície dotaz : " . mysql_error( ) ) ;
? > 
Všimnite si , e reazec pre mysql_query môeme napísa na jeden riadok , nemusí by nevyhnutne èlenená tak , som to ukazoval prve . Aj funkcie mysql_query má samozrejme právo skonèi chybou . O vychytávania chıb z tejto funkcie platí to, èo bolo povedané v minulom diele . Len dodajme , e príèin zlyhania mysql_query môe by celá rada . Medzi najznámejšie patria :

Ako argument je odovzdanı nieèo , èo databázy nepochopí ako platnı kód jazyka SQL 
Príkaz SQL je síce syntakticky správny, ale nemono ho vykona ( potrebné vytvorenie tabu¾ky , ktorá u existuje ) . 
Pre vykonanie príkazu nemáte potrebné práva . 
Neexistuje spojenie, ktoré by mysql_query obslúili .

Pouitie funkcie mysql_error môem v tomto prípade len odporuèi . MySQL sa toti pokúsi vysvetli Vám , èo jej nevoòajú .


V ïalšom diele nášho seriálu sa stretneme s hotovou aplikáciou na vyh¾adávanie PSÈ a názvov obcí . Na nej Vám ukáem , ako fungujú vıberové dotazy .

<br><br>




</body>
</html>
